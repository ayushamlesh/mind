
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Payment Monitoring Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background:#f4f6f9; }
        .card { border-radius:14px; }
        .kpi { font-size:22px; font-weight:600; }
        .muted { color:#6c757d; }
        .badge-health { font-size:13px; }
        .table thead th { background:#f8f9fa; }
        .store-row { cursor:pointer; }
        .store-row:hover { background:#f1f5ff; }
        .pill { padding:6px 12px; border-radius:20px; font-size:13px; }
        .pill-green { background:#e6f7ee; color:#198754; }
        .pill-yellow { background:#fff3cd; color:#997404; }
        .pill-red { background:#fdecea; color:#dc3545; }
        .terminal-card { border-left:6px solid #dee2e6; }
        .terminal-red { border-left-color:#dc3545; }
        .terminal-yellow { border-left-color:#ffc107; }
        .terminal-green { border-left-color:#198754; }
        .filter-btn.active { background:#0d6efd; color:#fff; }
    </style>
</head>
<body>
<div class="container-fluid p-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-bold">Payment Operations Dashboard</h4>
        <div class="btn-group">
            <button class="btn btn-outline-secondary filter-btn active" onclick="setTime('15m')">Last 15m</button>
            <button class="btn btn-outline-secondary filter-btn" onclick="setTime('30m')">30m</button>
            <button class="btn btn-outline-secondary filter-btn" onclick="setTime('24h')">24h</button>
            <button class="btn btn-outline-secondary filter-btn" onclick="setTime('48h')">48h</button>
            <button class="btn btn-outline-secondary filter-btn" onclick="setTime('allday')">All Day</button>
        </div>
    </div>

    <!-- GLOBAL INSIGHTS -->
    <div class="row g-3 mb-4">
        <div class="col-md-3"><div class="card p-3"><div class="muted">Total Stores</div><div class="kpi" id="kpiStores">200</div></div></div>
        <div class="col-md-3"><div class="card p-3"><div class="muted">Total Terminals</div><div class="kpi" id="kpiTerminals">12,430</div></div></div>
        <div class="col-md-3"><div class="card p-3"><div class="muted">Overall Approval %</div><div class="kpi" id="kpiApproval">91.6%</div></div></div>
        <div class="col-md-3"><div class="card p-3"><div class="muted">Vs Same Time Yesterday</div><div class="kpi text-danger" id="kpiYesterday">-3.2%</div></div></div>
    </div>

    <!-- STORE HEALTH BANDS -->
    <div class="row g-3 mb-4">
        <div class="col-md-4"><div class="card p-3"><div class="pill pill-green">Healthy Stores</div><div class="kpi" id="healthyCount">162</div></div></div>
        <div class="col-md-4"><div class="card p-3"><div class="pill pill-yellow">Watch Stores</div><div class="kpi" id="watchCount">28</div></div></div>
        <div class="col-md-4"><div class="card p-3"><div class="pill pill-red">Impacted Stores</div><div class="kpi" id="impactedCount">10</div></div></div>
    </div>

    <!-- ALL STORES TABLE -->
    <div class="card mb-4">
        <div class="card-header fw-semibold">All Stores Overview</div>
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>Store</th>
                        <th>Txn Count</th>
                        <th>Approval %</th>
                        <th>Vs Yesterday</th>
                        <th>Impacted Terminals</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="storeTable"></tbody>
            </table>
        </div>
    </div>

    <!-- STORE DETAIL -->
    <div class="card" id="storeDetail" style="display:none;">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span class="fw-semibold" id="storeTitle">Store</span>
            <button class="btn btn-sm btn-outline-secondary" onclick="closeStore()">Back to All Stores</button>
        </div>
        <div class="card-body">

            <!-- STORE KPIs -->
            <div class="row g-3 mb-4">
                <div class="col-md-3"><div class="card p-3"><div class="muted">Approval %</div><div class="kpi" id="sApproval"></div></div></div>
                <div class="col-md-3"><div class="card p-3"><div class="muted">Vs Yesterday</div><div class="kpi" id="sYesterday"></div></div></div>
                <div class="col-md-3"><div class="card p-3"><div class="muted">Txn Volume</div><div class="kpi" id="sTxn"></div></div></div>
                <div class="col-md-3"><div class="card p-3"><div class="muted">Active Terminals</div><div class="kpi" id="sTerms"></div></div></div>
            </div>

            <!-- TERMINAL GROUPS -->
            <div class="mb-3">
                <button class="btn btn-sm btn-outline-danger" onclick="filterTerminals('red')">Impacted</button>
                <button class="btn btn-sm btn-outline-warning" onclick="filterTerminals('yellow')">Degraded</button>
                <button class="btn btn-sm btn-outline-success" onclick="filterTerminals('green')">Healthy</button>
                <button class="btn btn-sm btn-outline-primary" onclick="filterTerminals('all')">All Terminals</button>
            </div>

            <div class="row" id="terminalGrid"></div>
        </div>
    </div>

</div>

<script>
    // ---------------- DUMMY DATA ----------------
    const stores = Array.from({ length: 200 }).map((_, i) => ({
        id: i + 1,
        name: `Store ${i + 1}`,
        txn: Math.floor(Math.random() * 9000) + 1000,
        approval: +(85 + Math.random() * 10).toFixed(1),
        yesterday: +(Math.random() * 6 - 3).toFixed(1),
        terminals: Array.from({ length: Math.floor(Math.random() * 50) + 50 }).map((_, t) => {
            const health = Math.random() > 0.8 ? 'red' : Math.random() > 0.6 ? 'yellow' : 'green';
            return {
                id: `T-${t + 1}`,
                health,
                approval: +(80 + Math.random() * 15).toFixed(1),
                decline: 'HOST_TIMEOUT'
            }
        })
    }));

    let currentStore = null;

    function renderStores() {
        const tbody = document.getElementById('storeTable');
        tbody.innerHTML = '';
        stores.slice(0, 50).forEach(s => {
            const impacted = s.terminals.filter(t => t.health === 'red').length;
            const status = impacted > 5 ? 'red' : impacted > 0 ? 'yellow' : 'green';
            tbody.innerHTML += `
                <tr class="store-row" onclick="openStore(${s.id})">
                    <td>${s.name}</td>
                    <td>${s.txn}</td>
                    <td>${s.approval}%</td>
                    <td class="${s.yesterday < 0 ? 'text-danger' : 'text-success'}">${s.yesterday}%</td>
                    <td>${impacted}</td>
                    <td><span class="pill pill-${status}">${status.toUpperCase()}</span></td>
                </tr>`;
        });
    }

    function openStore(id) {
        currentStore = stores.find(s => s.id === id);
        document.getElementById('storeDetail').style.display = 'block';
        document.getElementById('storeTitle').innerText = currentStore.name;
        document.getElementById('sApproval').innerText = currentStore.approval + '%';
        document.getElementById('sYesterday').innerText = currentStore.yesterday + '%';
        document.getElementById('sTxn').innerText = currentStore.txn;
        document.getElementById('sTerms').innerText = currentStore.terminals.length;
        filterTerminals('red');
    }

    function closeStore() {
        document.getElementById('storeDetail').style.display = 'none';
    }

    function filterTerminals(type) {
        const grid = document.getElementById('terminalGrid');
        grid.innerHTML = '';
        currentStore.terminals
            .filter(t => type === 'all' || t.health === type)
            .slice(0, 40)
            .forEach(t => {
                grid.innerHTML += `
                <div class="col-md-3 mb-3">
                    <div class="card terminal-card terminal-${t.health} p-3">
                        <div class="fw-semibold">${t.id}</div>
                        <div class="muted">Approval: ${t.approval}%</div>
                        <div class="muted">Top Error: ${t.decline}</div>
                    </div>
                </div>`;
            });
    }

    function setTime(range) {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        // Dummy: In real app, re-filter data based on time range
    }

    renderStores();
</script>
</body>
</html>
