<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Payment Monitoring Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background:#f4f6f9; }
        .card { border-radius:14px; }
        .kpi { font-size:22px; font-weight:600; }
        .muted { color:#6c757d; font-size:13px; }
        .pill { padding:6px 12px; border-radius:20px; font-size:12px; font-weight:600; }
        .pill-green { background:#e6f7ee; color:#198754; }
        .pill-yellow { background:#fff3cd; color:#997404; }
        .pill-red { background:#fdecea; color:#dc3545; }
        .store-row { cursor:pointer; }
        .store-row:hover { background:#f1f5ff; }
        .terminal-card { border-left:6px solid #dee2e6; }
        .terminal-red { border-left-color:#dc3545; }
        .terminal-yellow { border-left-color:#ffc107; }
        .terminal-green { border-left-color:#198754; }
        .time-btn.active { background:#0d6efd; color:#fff; }
        .sticky-header { position:sticky; top:0; z-index:10; background:#f4f6f9; }
    </style>
</head>
<body>
<div class="container-fluid p-4">

<div class="d-flex justify-content-between align-items-center mb-3 sticky-header">
    <h4 class="fw-bold">Payment Operations Command Center</h4>
    <div class="btn-group">
        <button class="btn btn-outline-secondary time-btn active" onclick="setTime(this,'15m')">15m</button>
        <button class="btn btn-outline-secondary time-btn" onclick="setTime(this,'30m')">30m</button>
        <button class="btn btn-outline-secondary time-btn" onclick="setTime(this,'24h')">24h</button>
        <button class="btn btn-outline-secondary time-btn" onclick="setTime(this,'48h')">48h</button>
        <button class="btn btn-outline-secondary time-btn" onclick="setTime(this,'allday')">All Day</button>
    </div>
</div>

<div class="row g-3 mb-4">
    <div class="col-md-3"><div class="card p-3"><div class="muted">Stores</div><div class="kpi">200</div></div></div>
    <div class="col-md-3"><div class="card p-3"><div class="muted">Terminals</div><div class="kpi">12,430</div></div></div>
    <div class="col-md-3"><div class="card p-3"><div class="muted">Approval %</div><div class="kpi">91.6%</div></div></div>
    <div class="col-md-3"><div class="card p-3"><div class="muted">Vs Yesterday</div><div class="kpi text-danger">-3.2%</div></div></div>
</div>

<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="card p-3" onclick="applyStoreFilter('green')" style="cursor:pointer;">
            <span class="pill pill-green">Healthy</span>
            <div class="kpi" id="healthyCnt">170</div>
            <div class="muted">Normal performance</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card p-3" onclick="applyStoreFilter('yellow')" style="cursor:pointer;">
            <span class="pill pill-yellow">Watch</span>
            <div class="kpi" id="watchCnt">20</div>
            <div class="muted">Deviation vs yesterday</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card p-3" onclick="applyStoreFilter('red')" style="cursor:pointer;">
            <span class="pill pill-red">Impacted</span>
            <div class="kpi" id="impactCnt">10</div>
            <div class="muted">Immediate attention needed</div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header fw-semibold d-flex justify-content-between">
        <span>All Stores</span>
        <input class="form-control form-control-sm w-25" placeholder="Search store" onkeyup="searchStore(this.value)">
    </div>
    <div class="table-responsive" style="max-height:420px; overflow:auto;">
        <table class="table table-hover mb-0">
            <thead>
                <tr>
                    <th>Store</th>
                    <th>Txn</th>
                    <th>Approval %</th>
                    <th>Vs Yesterday</th>
                    <th>Impacted Terms</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="storeTable"></tbody>
        </table>
    </div>
</div>

</div>

<div class="modal fade" id="storeModal" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="storeTitle"></h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">

        <div class="row g-3 mb-3">
            <div class="col-md-3"><div class="card p-3"><div class="muted">Approval %</div><div class="kpi" id="sApproval"></div></div></div>
            <div class="col-md-3"><div class="card p-3"><div class="muted">Vs Yesterday</div><div class="kpi" id="sYesterday"></div></div></div>
            <div class="col-md-3"><div class="card p-3"><div class="muted">Txn Volume</div><div class="kpi" id="sTxn"></div></div></div>
            <div class="col-md-3"><div class="card p-3"><div class="muted">Terminals</div><div class="kpi" id="sTerms"></div></div></div>
        </div>

        <ul class="nav nav-tabs mb-3">
          <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#termTab">Terminals</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#errorTab">Decline / Error Insights</button></li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane fade show active" id="termTab">
            <div class="mb-3">
                <button class="btn btn-sm btn-outline-danger" onclick="filterTerminals('red')">Impacted</button>
                <button class="btn btn-sm btn-outline-warning" onclick="filterTerminals('yellow')">Degraded</button>
                <button class="btn btn-sm btn-outline-success" onclick="filterTerminals('green')">Healthy</button>
                <button class="btn btn-sm btn-outline-primary" onclick="filterTerminals('all')">All</button>
            </div>
            <div class="row" id="terminalGrid"></div>
          </div>

          <div class="tab-pane fade" id="errorTab">
            <table class="table table-sm table-hover">
              <thead>
                <tr>
                  <th>Decline Reason</th>
                  <th>Txn Count</th>
                  <th>% of Store Txn</th>
                  <th>Card Type</th>
                  <th>Trend vs Yesterday</th>
                </tr>
              </thead>
              <tbody id="errorTable"></tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const stores = [];
let storeId = 1;

function createErrors(){
    return [
        { reason:'HOST_TIMEOUT', count:Math.floor(Math.random()*300)+50, pct:12.5, card:'VISA', trend:-2.1 },
        { reason:'BANK_DECLINE', count:Math.floor(Math.random()*500)+100, pct:18.3, card:'MC', trend:1.4 },
        { reason:'NETWORK_ERROR', count:Math.floor(Math.random()*200)+30, pct:6.8, card:'AMEX', trend:-0.6 }
    ];
}

function createStore(status){
    const terminalCount = Math.floor(Math.random()*50)+50;
    let redCount = 0, yellowCount = 0;

    if(status==='green') yellowCount = Math.floor(Math.random()*2);
    else if(status==='yellow'){ redCount = 1; yellowCount = 3; }
    else { redCount = 7; yellowCount = 5; }

    const terminals = [];
    for(let i=0;i<terminalCount;i++){
        let health='green';
        if(i<redCount) health='red';
        else if(i<redCount+yellowCount) health='yellow';
        terminals.push({
            id:`T-${i+1}`,
            health,
            approval:+(health==='green'?94:health==='yellow'?86:72).toFixed(1),
            decline: health==='red'?'HOST_TIMEOUT':health==='yellow'?'BANK_DECLINE':'-'
        });
    }

    return {
        id: storeId++,
        name:`Store ${storeId-1}`,
        txn:Math.floor(Math.random()*9000)+1000,
        approval:+(85+Math.random()*10).toFixed(1),
        yesterday:+(Math.random()*6-3).toFixed(1),
        terminals,
        errors:createErrors()
    };
}

for(let i=0;i<170;i++) stores.push(createStore('green'));
for(let i=0;i<20;i++) stores.push(createStore('yellow'));
for(let i=0;i<10;i++) stores.push(createStore('red'));

let currentStore=null;
let activeStoreFilter=null;

function getStoreStatus(store){
    const impacted = store.terminals.filter(t=>t.health==='red').length;
    return impacted>5?'red':impacted>0?'yellow':'green';
}

function renderStores(list=stores){
    const tb=document.getElementById('storeTable');
    tb.innerHTML='';
    list.slice(0,80).forEach(s=>{
        const impacted=s.terminals.filter(t=>t.health==='red').length;
        const status=getStoreStatus(s);
        tb.innerHTML+=`<tr class='store-row' onclick='openStore(${s.id})'>
            <td>${s.name}</td>
            <td>${s.txn}</td>
            <td>${s.approval}%</td>
            <td class='${s.yesterday<0?'text-danger':'text-success'}'>${s.yesterday}%</td>
            <td>${impacted}</td>
            <td><span class='pill pill-${status}'>${status}</span></td>
        </tr>`;
    });
}

function applyStoreFilter(status){
    activeStoreFilter=status;
    renderStores(stores.filter(s=>getStoreStatus(s)===status));
}

function searchStore(v){
    const value=v.toLowerCase();
    renderStores(stores.filter(s=>s.name.toLowerCase().includes(value)));
}

function openStore(id){
    currentStore=stores.find(s=>s.id===id);
    storeTitle.innerText=currentStore.name;
    sApproval.innerText=currentStore.approval+'%';
    sYesterday.innerText=currentStore.yesterday+'%';
    sTxn.innerText=currentStore.txn;
    sTerms.innerText=currentStore.terminals.length;
    filterTerminals('red');
    renderErrors();
    new bootstrap.Modal(document.getElementById('storeModal')).show();
}

function filterTerminals(type){
    const g=document.getElementById('terminalGrid');
    g.innerHTML='';
    currentStore.terminals.filter(t=>type==='all'||t.health===type).slice(0,48).forEach(t=>{
        g.innerHTML+=`<div class='col-md-3 mb-3'>
            <div class='card terminal-card terminal-${t.health} p-3'>
                <div class='fw-semibold'>${t.id}</div>
                <div class='muted'>Approval ${t.approval}%</div>
                <div class='muted'>Top Error ${t.decline}</div>
            </div>
        </div>`;
    });
}

function renderErrors(){
    const tb=document.getElementById('errorTable');
    tb.innerHTML='';
    (currentStore.errors||[]).forEach(e=>{
        tb.innerHTML+=`<tr>
            <td>${e.reason}</td>
            <td>${e.count}</td>
            <td>${e.pct}%</td>
            <td>${e.card}</td>
            <td class='${e.trend<0?'text-danger':'text-success'}'>${e.trend}%</td>
        </tr>`;
    });
}

function setTime(btn,v){
    document.querySelectorAll('.time-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
}

renderStores();
</script>
</body>
</html>
